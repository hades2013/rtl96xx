/*
 * Copyright (C) 2012 Realtek Semiconductor Corp. 
 * All Rights Reserved.
 *
 * This program is the proprietary software of Realtek Semiconductor
 * Corporation and/or its licensors, and only be used, duplicated, 
 * modified or distributed under the authorized license from Realtek. 
 *
 * ANY USE OF THE SOFTWARE OTHER THAN AS AUTHORIZED UNDER 
 * THIS LICENSE OR COPYRIGHT LAW IS PROHIBITED. 
 *
 */


#include "app_basic.h"
#include "omci_defs.h"

MIB_TABLE_INFO_T gMibMcastSubMonitorTableInfo;
MIB_ATTR_INFO_T  gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ATTR_NUM];
MIB_TABLE_MCASTSUBMONITOR_T gMibMcastSubMonitorDefRow;
MIB_TABLE_OPER_T gMibMcastSubMonitorOper;


GOS_ERROR_CODE McastSubMonitorDumpMib(void *pData)
{
	MIB_TABLE_MCASTSUBMONITOR_T *pMcastSubMonitor = (MIB_TABLE_MCASTSUBMONITOR_T*)pData;
	OMCI_LOG(OMCI_LOG_LEVEL_HIGH,"%s", "McastSubMonitor");

	OMCI_LOG(OMCI_LOG_LEVEL_HIGH,"EntityId: 0x%02x", pMcastSubMonitor->EntityId);
	OMCI_LOG(OMCI_LOG_LEVEL_HIGH,"MeType: %d", pMcastSubMonitor->MeType);
	OMCI_LOG(OMCI_LOG_LEVEL_HIGH,"CurrMcastBandwidth: %d", pMcastSubMonitor->CurrMcastBandwidth);
	OMCI_LOG(OMCI_LOG_LEVEL_HIGH,"JoinMsgCounter: %d", pMcastSubMonitor->JoinMsgCounter);
	OMCI_LOG(OMCI_LOG_LEVEL_HIGH,"BandwidthExcCounter: %d", pMcastSubMonitor->BandwidthExcCounter);
	OMCI_LOG(OMCI_LOG_LEVEL_HIGH,"ActiveGroupListTable: %s", pMcastSubMonitor->ActiveGroupListTable);

	return GOS_OK;
}

GOS_ERROR_CODE McastSubMonitorDrvCfg(MIB_TABLE_INDEX tableIdx, void* pOldRow, void* pNewRow, MIB_OPERA_TYPE operationType)
{
	OMCI_LOG(OMCI_LOG_LEVEL_LOW,"%s: process end\n", __FUNCTION__);
	return GOS_OK;
}

GOS_ERROR_CODE McastSubMonitor_Init(void)
{
    gMibMcastSubMonitorTableInfo.Name = "McastSubMonitor";
    gMibMcastSubMonitorTableInfo.Desc = "Multicast subscriber monitor";
    gMibMcastSubMonitorTableInfo.MaxEntry = (UINT32)(32);
    gMibMcastSubMonitorTableInfo.ClassId = (UINT32)(311);
    gMibMcastSubMonitorTableInfo.InitType = (UINT32)(PON_ME_INIT_TYPE_BY_OLT);
    gMibMcastSubMonitorTableInfo.StdType = (UINT32)(PON_ME_STD_TYPE_STD);
    gMibMcastSubMonitorTableInfo.ActionType = (UINT32)(PON_ME_ACTION_CREATE | PON_ME_ACTION_DELETE | PON_ME_ACTION_SET | PON_ME_ACTION_GET | PON_ME_ACTION_GET_NEXT);
    gMibMcastSubMonitorTableInfo.pAttributes = &(gMibMcastSubMonitorAttrInfo[0]);

	gMibMcastSubMonitorTableInfo.attrNum = MIB_TABLE_MCASTSUBMONITOR_ATTR_NUM;
	gMibMcastSubMonitorTableInfo.entrySize = sizeof(MIB_TABLE_MCASTSUBMONITOR_T);
	gMibMcastSubMonitorTableInfo.pDefaultRow = &gMibMcastSubMonitorDefRow;

    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ENTITYID_INDEX - MIB_TABLE_FIRST_INDEX].Name = "EntityId";
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_METYPE_INDEX - MIB_TABLE_FIRST_INDEX].Name = "MeType";
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_CURRMCASTBANDWIDTH_INDEX - MIB_TABLE_FIRST_INDEX].Name = "CurrMcastBandwidth";
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_JOINMSGCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].Name = "JoinMsgCounter";
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_BANDWIDTHEXCCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].Name = "BandwidthExcCounter";
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ACTIVEGROUPLISTTABLE_INDEX - MIB_TABLE_FIRST_INDEX].Name = "ActiveGroupListTable";

    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ENTITYID_INDEX - MIB_TABLE_FIRST_INDEX].Desc = "Entity ID";
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_METYPE_INDEX - MIB_TABLE_FIRST_INDEX].Desc = "ME Type";
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_CURRMCASTBANDWIDTH_INDEX - MIB_TABLE_FIRST_INDEX].Desc = "Current multicast bandwidth";
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_JOINMSGCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].Desc = "Join message counter";
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_BANDWIDTHEXCCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].Desc = "Bandwidth excessed counter";
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ACTIVEGROUPLISTTABLE_INDEX - MIB_TABLE_FIRST_INDEX].Desc = "Active group list table";

    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ENTITYID_INDEX - MIB_TABLE_FIRST_INDEX].DataType = MIB_ATTR_TYPE_UINT16;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_METYPE_INDEX - MIB_TABLE_FIRST_INDEX].DataType = MIB_ATTR_TYPE_UINT8;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_CURRMCASTBANDWIDTH_INDEX - MIB_TABLE_FIRST_INDEX].DataType = MIB_ATTR_TYPE_UINT32;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_JOINMSGCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].DataType = MIB_ATTR_TYPE_UINT32;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_BANDWIDTHEXCCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].DataType = MIB_ATTR_TYPE_UINT32;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ACTIVEGROUPLISTTABLE_INDEX - MIB_TABLE_FIRST_INDEX].DataType = MIB_ATTR_TYPE_STR;

    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ENTITYID_INDEX - MIB_TABLE_FIRST_INDEX].Len = 2;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_METYPE_INDEX - MIB_TABLE_FIRST_INDEX].Len = 1;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_CURRMCASTBANDWIDTH_INDEX - MIB_TABLE_FIRST_INDEX].Len = 4;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_JOINMSGCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].Len = 4;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_BANDWIDTHEXCCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].Len = 4;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ACTIVEGROUPLISTTABLE_INDEX - MIB_TABLE_FIRST_INDEX].Len = 24;

    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ENTITYID_INDEX - MIB_TABLE_FIRST_INDEX].IsIndex = TRUE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_METYPE_INDEX - MIB_TABLE_FIRST_INDEX].IsIndex = FALSE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_CURRMCASTBANDWIDTH_INDEX - MIB_TABLE_FIRST_INDEX].IsIndex = FALSE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_JOINMSGCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].IsIndex = FALSE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_BANDWIDTHEXCCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].IsIndex = FALSE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ACTIVEGROUPLISTTABLE_INDEX - MIB_TABLE_FIRST_INDEX].IsIndex = FALSE;

    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ENTITYID_INDEX - MIB_TABLE_FIRST_INDEX].UsrAcc = MIB_ATTR_USR_READ_ONLY;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_METYPE_INDEX - MIB_TABLE_FIRST_INDEX].UsrAcc = MIB_ATTR_USR_WRITE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_CURRMCASTBANDWIDTH_INDEX - MIB_TABLE_FIRST_INDEX].UsrAcc = MIB_ATTR_USR_WRITE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_JOINMSGCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].UsrAcc = MIB_ATTR_USR_WRITE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_BANDWIDTHEXCCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].UsrAcc = MIB_ATTR_USR_WRITE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ACTIVEGROUPLISTTABLE_INDEX - MIB_TABLE_FIRST_INDEX].UsrAcc = MIB_ATTR_USR_WRITE;

    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ENTITYID_INDEX - MIB_TABLE_FIRST_INDEX].MibSave = TRUE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_METYPE_INDEX - MIB_TABLE_FIRST_INDEX].MibSave = TRUE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_CURRMCASTBANDWIDTH_INDEX - MIB_TABLE_FIRST_INDEX].MibSave = TRUE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_JOINMSGCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].MibSave = TRUE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_BANDWIDTHEXCCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].MibSave = TRUE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ACTIVEGROUPLISTTABLE_INDEX - MIB_TABLE_FIRST_INDEX].MibSave = TRUE;

    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ENTITYID_INDEX - MIB_TABLE_FIRST_INDEX].OutStyle = MIB_ATTR_OUT_HEX;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_METYPE_INDEX - MIB_TABLE_FIRST_INDEX].OutStyle = MIB_ATTR_OUT_DEC;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_CURRMCASTBANDWIDTH_INDEX - MIB_TABLE_FIRST_INDEX].OutStyle = MIB_ATTR_OUT_DEC;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_JOINMSGCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].OutStyle = MIB_ATTR_OUT_DEC;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_BANDWIDTHEXCCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].OutStyle = MIB_ATTR_OUT_DEC;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ACTIVEGROUPLISTTABLE_INDEX - MIB_TABLE_FIRST_INDEX].OutStyle = MIB_ATTR_OUT_CHAR;

    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ENTITYID_INDEX - MIB_TABLE_FIRST_INDEX].OltAcc = PON_ME_OLT_READ;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_METYPE_INDEX - MIB_TABLE_FIRST_INDEX].OltAcc = PON_ME_OLT_READ | PON_ME_OLT_WRITE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_CURRMCASTBANDWIDTH_INDEX - MIB_TABLE_FIRST_INDEX].OltAcc = PON_ME_OLT_READ | PON_ME_OLT_WRITE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_JOINMSGCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].OltAcc = PON_ME_OLT_READ | PON_ME_OLT_WRITE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_BANDWIDTHEXCCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].OltAcc = PON_ME_OLT_READ | PON_ME_OLT_WRITE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ACTIVEGROUPLISTTABLE_INDEX - MIB_TABLE_FIRST_INDEX].OltAcc = PON_ME_OLT_READ | PON_ME_OLT_WRITE;

    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ENTITYID_INDEX - MIB_TABLE_FIRST_INDEX].AvcFlag = FALSE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_METYPE_INDEX - MIB_TABLE_FIRST_INDEX].AvcFlag = FALSE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_CURRMCASTBANDWIDTH_INDEX - MIB_TABLE_FIRST_INDEX].AvcFlag = FALSE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_JOINMSGCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].AvcFlag = FALSE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_BANDWIDTHEXCCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].AvcFlag = FALSE;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ACTIVEGROUPLISTTABLE_INDEX - MIB_TABLE_FIRST_INDEX].AvcFlag = FALSE;

    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ENTITYID_INDEX - MIB_TABLE_FIRST_INDEX].OptionType = PON_ME_ATTR_MANDATORY;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_METYPE_INDEX - MIB_TABLE_FIRST_INDEX].OptionType = PON_ME_ATTR_MANDATORY;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_CURRMCASTBANDWIDTH_INDEX - MIB_TABLE_FIRST_INDEX].OptionType = PON_ME_ATTR_OPT_SUPPORT;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_JOINMSGCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].OptionType = PON_ME_ATTR_OPT_SUPPORT;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_BANDWIDTHEXCCOUNTER_INDEX - MIB_TABLE_FIRST_INDEX].OptionType = PON_ME_ATTR_OPT_SUPPORT;
    gMibMcastSubMonitorAttrInfo[MIB_TABLE_MCASTSUBMONITOR_ACTIVEGROUPLISTTABLE_INDEX - MIB_TABLE_FIRST_INDEX].OptionType = PON_ME_ATTR_MANDATORY;

    memset(&(gMibMcastSubMonitorDefRow.EntityId), 0x00, sizeof(gMibMcastSubMonitorDefRow.EntityId));
    memset(&(gMibMcastSubMonitorDefRow.MeType), 0x00, sizeof(gMibMcastSubMonitorDefRow.MeType));
    memset(&(gMibMcastSubMonitorDefRow.CurrMcastBandwidth), 0x00, sizeof(gMibMcastSubMonitorDefRow.CurrMcastBandwidth));
    memset(&(gMibMcastSubMonitorDefRow.JoinMsgCounter), 0x00, sizeof(gMibMcastSubMonitorDefRow.JoinMsgCounter));
    memset(&(gMibMcastSubMonitorDefRow.BandwidthExcCounter), 0x00, sizeof(gMibMcastSubMonitorDefRow.BandwidthExcCounter));
    strncpy(&(gMibMcastSubMonitorDefRow.ActiveGroupListTable), "0", sizeof(gMibMcastSubMonitorDefRow.ActiveGroupListTable));

    gMibMcastSubMonitorOper.meOperDrvCfg = McastSubMonitorDrvCfg;
    gMibMcastSubMonitorOper.meOperConnCheck = NULL;
    gMibMcastSubMonitorOper.meOperDump = McastSubMonitorDumpMib;
	gMibMcastSubMonitorOper.meOperConnCfg = NULL;

    MIB_Register(MIB_TABLE_MCASTSUBMONITOR_INDEX, &gMibMcastSubMonitorTableInfo, &gMibMcastSubMonitorOper);

    return GOS_OK;
}

