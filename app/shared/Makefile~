# Makefile for shared

LIB_VERMAJOR = 0
LIB_VERMINOR = 1
LIB_FILENAME = libshared.so
LIB_STATIC   = libshared.a

LIB_CFLAGS  = $(CFLAGS) -shared -fPIC -I. -DMDC_MDIO_OPERATION -D_LITTLE_ENDIAN
LIB_LDFLAGS = $(LDFLAGS) -Wl,-soname,$(LIB_FILENAME).$(LIB_VERMAJOR).$(LIB_VERMINOR)

CLI_CFLAGS  = $(CFLAGS) -I.
CLI_LDFLAGS = $(LDFLAGS)

LIB_OBJS = hex_utils.o

all: shared

cli: lib8367m
	$(CC) $(CLI_CFLAGS) -c -o $(CLI_OBJ) $(CLI_SRC)
	$(CC) -o $(CLI_FILENAME) $(CLI_LDFLAGS) $(CLI_OBJ) \
		$(LIB_FILENAME).$(LIB_VERMAJOR).$(LIB_VERMINOR)

shared: $(LIB_OBJS)
#	$(CC) $(LIB_CFLAGS) $(LIB_LDFLAGS) \
#		-o $(LIB_FILENAME).$(LIB_VERMAJOR).$(LIB_VERMINOR) $(LIB_OBJS)
	$(AR) -r $(LIB_STATIC) $(LIB_OBJS)
#	@rm -fr $(LIB_FILENAME)
#	@ln -s $(LIB_FILENAME).$(LIB_VERMAJOR).$(LIB_VERMINOR) $(LIB_FILENAME)
	
clean:
	rm -fr $(LIB_FILENAME) *.o *.so $(CLI_FILENAME)

install: all
	$(CROSS_COMPILE)strip $(LIB_FILENAME).$(LIB_VERMAJOR).$(LIB_VERMINOR)
	install -D $(LIB_FILENAME).$(LIB_VERMAJOR).$(LIB_VERMINOR) $(CONFIG_PREFIX)/usr/lib/$(LIB_FILENAME).$(LIB_VERMAJOR).$(LIB_VERMINOR)

#Rules
%.o: %.c
	$(CC) $(LIB_CFLAGS) -c -o $@ $^
		